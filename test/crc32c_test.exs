defmodule KlifeProtocol.CRC32cTest do
  use ExUnit.Case, async: true

  alias KlifeProtocol.CRC32c

  @tag core: true
  test "execute/1" do
    assert CRC32c.execute(<<>>) == 0

    # This hex uses all the polynomial indexes 0 to 255, this way we can assure that the lookup table is 100% correct
    magic_hex =
      "B3209CE95E5C338C3FF9DA9A129AAE1E4BED0E9BAD1DD9B45178E80CF9F387FF50CC8C72AAD42A189218B8FBE70CEFB8572144E6BC25660A6DF12F3CA2B249FA810A3DAAE495F5602CA4A406F45C56A1CC86F3B372546E59625D09A8F5F289EE6178D6669C239CC240B5D74CCFB080AB8681D5EEACD2096E7D36FAF0E3E530958540BED216620462C1E1FE845D1878D772162D0803E6C569436D2A31CBD10417245B384C201B292532082E1014D43A17EDF6902CA3EFE5C1A5B19B1638D4EA5743F43228284CBBDEA251DBAE117D5278AC08AEFDD72E31A7085267A7BE6EF63F55C89384BA8233C256685BC73B809CF6AE97B447A693123DD58CC24C4F264D86E333E33C62182EBC9C095900885241F584A02F49D214904B1BF202EFCF896EE6C22E70026674E8BFB3E29AE4967F612719614C025090ECAF81B61FBF7372C3EB1B24F67618DD6D15101B2D01E625864B5322EAE42A845A46A38495EACAE52AD7EB9F2560AEFA1971C7470753F6AC984627DF4395CF8427B925F3DEFFDEDFD433614FF766F5A126A8670046C6DD81D212104DF6827076DEB7EB518D1ABDC0DDF9358663C891458982711791A39D4DD6AA7273004B6C25406E8A1BACE8D8F6B1C858453DA41F6873596476471716266F0DA52EDAA5154CEAA57C8522554ABC9A84C326C68127C29B1C6ED54D659A9299E324F165ED83C3893B38B564D95EBA55BD6DD07BF0283C0ABF26029FDF27E43601D5BB1FF4B7040B501C9FBB780120498589DEEFECB1935DC77964B7C9E6DC04E2CEBF7A45CC4D27835EEC88F4BF9A14814B981EABE672E5A51F24A3244A1884C37D3FB80D260951843C3DFD726F9A83838140316C60E0DCAFFBA5F7F1FF28F6CC31F83173D0C1FA688D8218CF132E8B87E2A440D3629FC29D957A3C3909B0F82F63101A4AEA2E08821E7DE17284143C8360FC40AE2CF38F228367F1D9201B9C26F9EF4344A469A45D81B0A6BE3166A52B8233005CE3D58B508D95FE0462004ECA6B6D9A3256DF6C7E48DD7355AED33685EC4D04D36C170A18BF227AECFBC2B58CEB79877D7741DD151B9EFE161749E7EEDA0FB18A0D172124E81EDF2906B41F57DF05DEDA63F561ADB3C17C55E005E254272F71EFB1541053016FE2D5A93722D134C5AA8CD89C7E2706C0804E5D007E7EA286B6F24A07A638398B10C8BEF3D9C0447881F4F2DDB93C11A5A626BB8074BE839D59B8E27BBB242618C04CF5E0986F94CB553E5EC4C21EB669E080B9E3F73E3F24F8F0C6498DB3B3016605390439FD24DA1053457E1FE5FE1232188CC5164681F0CF7087165ECF75A546AD642C56905ABBE542C343D4EEC1421836BE9AA9BA3B30E0B7EAF678D4880CBB184171A574F16E2E2833994139CC9DC8C0A2A898A0CA2D31162AE0656B3AC8209291349BE5FC99EF1F6F907918D17F6CEA8332817F"

    assert CRC32c.execute(:binary.decode_hex(magic_hex)) == 3_713_957_906
  end
end
